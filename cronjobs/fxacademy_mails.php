<?php
set_include_path('/home/tboy9/public_html/init/');
require_once 'initialize_general.php';

$my_subject_1a = "Your Forex Profit Optimizer course is on…";
$my_message_1a =
    <<<MAIL
<p>Dear [Name]</p>
<p>Trust you are doing well.</p>
<p>Your optimizer course has begun and you are late for class!!!</p>
<p>Your payment for the optimizer class has been long approved but you are yet to start the lessons.</p>
<p>Where have you been?</p>
<p>    I quite understand that you have been very busy, however, I’d like to encourage you to take out time to begin your training so you can start earning extra money.
Your training portal awaits and all you need to do is begin now.</p>
<p>Rest assured, after the training, you will be fully equipped to trade profitably and optimally.</p>
<p>Start taking your lessons now here https://bit.ly/2iExTpN</p>
<p>Hurry Now! I can’t wait to for you to join our league of profitable traders</p>
MAIL;

$my_subject_1a = " You’ve Paid Your Dues [NAME], you deserve…";
$my_message_1a =
    <<<MAIL
<p>Hello [Name]</p>
<p>How are you doing?</p>
<p>    I noticed that you have paid for your optimizer course and you are yet to start the training.</p>
<p>If this is about not having enough time to take the course, I perfectly understand, because time seems to be very limited and there is so much to achieve every day.</p>
<p>The secret to time and harnessing it value is simply starting and completing all you need to do immediately.</p>
<p>That way you can be sure to get the expected results and move on to other tasks.</p>
<p>Easy and efficient right?</p>
<p>    Tag along [Name], you have paid your dues and you sure deserve to get your money’s worth.</p>
<p>Why not start your course this weekend? That way you can lay comfortably on your bed on a Saturday morning, take the course on your phone and practice your newly acquired skill.</p>
<p>Click here to begin your profit optimizer course now.</p>
<p>I would love for you to start and complete your optimizer course as soon as possible because it will equip you to be prepared to trade profitably.</p>
<p>If you have any concern, please feel free share with me</p>
<p>I am eager to read and respond to your email.</p>
MAIL;

$my_subject_1c = "Your Training Portal Awaits you";
$my_message_1c =
    <<<MAIL
<p>Hello [Name],</p>
<p>Just checking on you.</p>
<p>How have you been?</p>
<p>    You are yet to start your Forex Profit Optimizer course, and I just want to remind you that your payment for this course has been long approved and you can access your training now.</p>
<p>I am eager for you to begin this course because I am quite confident that after taking it, you will have a good start at trading and it would be easy for you to develop winning trading strategies and make good profits from trading Forex.</p>
<p>The Loyalty Reward Program for this year has begun and you are missing out!</p>
<p>The sooner you begin and conclude the Forex Profit Optimizer course, the earlier you start trading and making money from your trades.</p>
<p>[Name], you can still hit this year’s financial target and become a millionaire!</p>
<p>Complete your course and get equipped now! Click here to begin now.</p>
<p>I look forward to seeing you in class.</p>
<p>Please feel free to reach out to me if you need any assistance. I’ll always be here.</p>
MAIL;

$my_subject_1d = "All you Need to build a Successful Side Business is in here";
$my_message_1d =
    <<<MAIL
<p>Dear [Name],</p>
<p>I hope you are doing well?</p>
<p>    You have been off your training for a very long time, are you experiencing any difficulty? If yes, please click here to send me a mail so I can get in on it and assist you with it right away.</p>
<p>Do you know that with the right knowledge, you can make millions of dollars while trading Forex? I bet you do!</p>
<p>I would like to encourage you to take your Forex Profit optimizer course today as I want to see you make more money and see the result of signing up from the start.</p>
<p>A lot of other traders who started the training with you have begun to cash out hundreds and thousands of dollars.</p>
<p>Don’t wait a day more! Click here to start your Forex Profit Optimizer course so you can finish it in good time.</p>
<p>I’m earnestly rooting for you [NAME] and I can’t wait for you to become a pro at this and start making money with ease.</p>
<p>
<button style="background: #2f88bc; border-radius: 15px; height: 35px;"><strong><a style="text-decoration: none; text-align: center; color: white;" href="http://bit.ly/2iExTpN" target="_blank">Get me Started</a></strong>
</button></p>
MAIL;

$my_subject_2a = "";
$my_message_2a =
    <<<MAIL
<p>Dear [NAME],</p>
<p>How are you doing?</p>
<p>    I am happy to see that you are half way gone with your Forex profit optimizer course.</p>
<p>Well done [NAME]! You have come a long way and I’m super proud of you!</p>
<p>You have just a few lessons more and I would really like you to take one step further and complete the lessons.</p>
<p>Do not leave any stone unturned as information is key to trading Forex successfully!</p>
<p>A lot of traders have made thousands of dollars this year already, you definitely should not miss out on this opportunity to make more money from Forex trading.</p>
<p>Get equipped now by completing your course and in few weeks you will be cashing out like a pro.</p>
<p>Click here to finish your profit optimizer course right away!</p>
<p>Should you experience any challenge or need any help, do well to reply this mail and I will be sure to respond swiftly.</p>
MAIL;

$my_subject_2b = "All that you need to know is just a click away";
$my_message_2b =
    <<<MAIL
<p>Dear [Name],</p>
<p>Good day,</p>
<p>How have you been?</p>
<p>    I noticed you haven’t completed your Forex Profit Optimizer course yet.</p>
<p>The journey has begun and I believe in you.</p>
<p>It’s important that you get all the information you need to create and implement key strategies that will help you make more profit with ease.</p>
<p>Time is money [NAME]! The earlier you conclude your course the better!</p>
<p>With more knowledge, you will definitely be a professional trader with steady income in your account.</p>
<p>Click <a href="C:\Users\InstaForex\Desktop\bit.ly\2iExTpN">here</a> to finish your course right away!</p>
<p>Are you stuck at a particular lesson, do you need clearer explanations?</p>
<p>    Kindly let me know how to help you move on with your course, and begin to make more money.</p>
<p>I am looking forward to your response.</p>
MAIL;

$my_subject_2c = "[NAME], Here’s a Boss Move You Should Take Today";
$my_message_2c =
    <<<MAIL
<p>Hello [Name],</p>
<p>Pipsy the trainer, asked about you today!</p>
<p>How are you?</p>
<p>    It’s been a while you checked into your training portal.</p>
<p>You have probably been very busy and don’t have time to login to take the training.</p>
<p>Currently, 5.3tr is traded in the Forex market on a daily basis and those who have acquired the right skill are benefitting from the market right now.</p>
<p>With how far you have come in this course, you are 50-70% ready to start making money from Forex.</p>
<p>Trust me, when it comes to Forex trading, that percent isn’t enough. You need to complete the Forex Profit Optimizer course so you can join the pool of traders making steady profits from Forex trading.</p>
<p>Ready to finish up now?</p> 
<p>Click <a href="C:\Users\InstaForex\Desktop\bit.ly\2iExTpN">here to complete the course right away.</a></p>
<p>I’ll be waiting for you at the other side.</p>
MAIL;

$my_subject_2d = "[NAME], Don’t Be Like Bukky!";
$my_message_2d =
    <<<MAIL
<p>Hello [NAME],</p>
<p>Bukky, who went from being a newbie to a Pro trader sent in her testimonial on the Forex Profit Optimizer Course.</p>
<p>I started out as a novice trader and went through the Forex money maker course.</p>
<p>At the conclusion of lesson 3, I quickly created my live account, funded it and placed a trade.</p>
<p>I was so eager to make money.</p>
<p>Guess what? I was so lucky I made profit on my first trade.</p>
<p>That felt so good and then I began to brag that I was a forex trader!</p>
<p>Little did I know that I was headed for the rock without adequate information, training and skill.</p>
<p>The following week I decided to trade a larger lot size (I didn’t know about the 3 types of lot sizes and how to use them). I had neither the skill nor the strategy to trade profitably.</p>
<p>Oops! The trade didn’t go in my favor, my money was gone…I became sad and left my account dormant for months.</p>
<p>                                                                                                      Scrolling through my mail box later on, I saw several reminders to continue my course and what I would gain in the following course!</p>
<p>This was my chance to take another shot at it! I jumped at it and after the course I was sure of the next steps to take and how to calculate and manage my risk.</p>
<p>I experimented my new skills in my demo account, afterwards I became a pro trader, I could even create my own trading strategy and started trading profitably on my live account!</p>
<p>Don’t be like Bukky who had it rough before getting it right.</p>
<p>Click  <a href="C:\Users\InstaForex\Desktop\bit.ly\2iExTpN">here</a> to continue from where you stopped.</p>
<p>You are a few lessons away to becoming a professional trader and hitting your income goals!</p>
<p>Make sure to click here to take the remaining lessons now.</p>
<p>Experiencing any challenge? Kindly hit the reply button to share the challenge with me so I can look into it immediately.</p>
<p>I look forward to reading and responding to your reply.</p>
MAIL;

$my_subject_3a = "";
$my_message_3a =
    <<<MAIL
<p>Dear [NAME]</p>
<p>How are you doing?</p>
<p>Today, I had a very interesting conversation with our market analyst.</p>
<p>I found out something amazing and I thought to share that with you.</p>
<p>The Forex market is currently worth $5.3Trillion and on a daily basis, more than half of that money exchanges hands yielding into lots of profits for skillful traders in the market.</p>
<p>Doesn’t this excite you? Let me break it down…</p>
<p>For you, this simply means you have been missing out on a whole lot of money because you haven’t started trading.</p>
<p>Start today! Click <a href="http://bit.ly/2mpqehQ">here</a> to quickly open a Forex account immediately if you haven’t done that before now.</p>
<p>Start trading now so that you can get as much profit as you can before the year runs out, we are ready to reward you every step of the way.</p>
<p>To start with, you’ll get a whopping $130% bonus on your first deposit of either $50, $100 or $150.</p>
<p>You can click here to claim your bonus now. Don’t let all the money pass you by oo.</p>
MAIL;

$my_subject_3b = "[Name], You are missing out on our 130% Bonus Offer.";
$my_message_3b =
    <<<MAIL
<p>Dear [Name],</p>
<p>Got your 130% bonus yet?</p>
<p>For completing your Forex Optimizer Couse, we are offering you a whopping 130% bonus on your first deposit of either $50, $100 $150.</p>
<p>We are also offering you the opportunity to earn and redeem loyalty points as you trade.</p>
<p>We won’t stop there! As an esteemed client you also get the chance to win bonuses or cash prizes monthly and yearly.</p>
<p>It’s not too late to start enjoying all this benefits, click <a href="http://bit.ly/2BjGSYF">here</a> to begin.</p>
<p>The 130% bonus allows you to have ample funds to start trading with therefore if you make a deposit of $50, you will get an extra $65 making a total $115.</p>
<p>On your deposit of $100, you will get an extra $130 which makes a total of $230 and on $150, you will get an extra $195 and this makes a total of $345.</p>
<p>Wow! What an amazing opportunity to increase your capital base so you can make more money from your trades.</p>
<p>A lot of traders have already started meeting their monthly financial goals and you can get your own share too.</p>
<p>Click here to claim your bonus right away!</p>
<p>Don’t have an account yet? Quickly go here to open one.</p>
MAIL;


$my_subject_3c = "[Name], Grab your Share of  $5.3 Trillion Today!";
$my_message_3c =
    <<<MAIL
<p>More than $10000 profit have been made today!</p>
<p>Hello [NAME]!</p>
<p>Where are you been?</p>
<p>    You have missed a lot! can only give you the gist.</p>
<p>A lot of traders have cashed out this week, and have begun to hit their financial goals for the month because the forex market is heavily liquid.</p>
<p>Take advantage of this and get on the train! Open a live account right now, claim your bonuses, begin to trade and earn instantly.</p>
<p>Click <a href="http://bit.ly/2mpqehQ">Open live account</a> to start right away!</p>
<p>You are filled with potentials already so do not let the skills go to waste.You’re half way into becoming financially free and I’ve got confidence in you.</p>
<p>While all this money is exchanging hands, make sure it gets to you!</p>
<p>Ready now? Don’t be stuck here go to the next phase…if you’ve got an account already, go ahead and click <a href="http://bit.ly/2BjGSYF">ready to make more money</a> to fund and claim your bonuses.</p>
<p>If you need any help while setting up your account, funding or even while you trade, please leave me a message, I will always be here for you.</p>
<p>I can’t wait to see you top our loyalty chat and get rewarded, see you at the top soon.</p>
MAIL;

$my_subject_3d = "[NAME], Be The Lucky Winner of $250 This Month.";
$my_message_3d =
    <<<MAIL
<p>Dear [NAME],</p>
<p>How are you today?</p>
<p>    Something mega has been happening behind you, so I quickly stopped by to hint you.</p>
<p>Every month the top 5 loyal active traders on InstaFxNg share $500! And you look like the next winner.</p>
<p>Now that you have completed your optimizer course, it’s time to start earning and getting rewards.</p>
<p>Wondering how to?  Follow my little secret step below</p>
<p>Here’s how to get there;</p>
<ul>
    <li>Open a live account <a href="http://bit.ly/2mpqehQ">here</a></li>
    <li>Fund your account with either $50, $100 or $150 dollars and above then <a href="mailto:support@instafxng.com?subject=130%20Percent%20Bonus%20&body=Hello%20Mercy,%0A%0AI%20am%20interested%20in%20getting%20the%20130%20percent%20bonus.%0A%0AThanks!">click get my share</a> to enjoy a 130% bonus right away!</li>
    <li>Start trading, keep trading and finally don’t stop trading.</li>
 </ul>
<p>That’s all! Just that and you can qualify for the monthly share.</p>
<p>Don’t worry winners will not be selected at random, they would be picked by total points gathered, so yes! You’ve got the chance to be the winner if you start trading from today.</p>
<p>I honestly do not want anybody to get a point higher than you, so get started now.</p>
<p>Don’t sleep on this gossip, act on it now!</p>
<p>[NAME], If you experience any difficulty in going through my secret step, please send me a message.</p>
<p>I’ll be eager to respond and clarify any issue.</p>
MAIL;


function student_auto_mail_template($core_msg) {

    $my_message_template =
        <<<MAIL
<div style="background-color: #F3F1F2">
    <div style="max-width: 80%; margin: 0 auto; padding: 10px; font-size: 14px; font-family: Verdana;">
        <img src="https://instafxng.com/images/ifxlogo.png" />
        <hr />
        <div style="background-color: #FFFFFF; padding: 15px; margin: 5px 0 5px 0;">

            $core_msg

            <br /><br />
            <p>Best Regards,</p>

            <p>Your friend,<br />
            Mercy,<br />
            Client Relations Manager.</p>
            <p>Instaforex Nigeria,<br />
                www.instafxng.com</p>
            <br /><br />
        </div>
        <hr />
        <div style="background-color: #EBDEE9;">
            <div style="font-size: 11px !important; padding: 15px;">
                <p style="text-align: center"><span style="font-size: 12px"><strong>We're Social</strong></span><br /><br />
                    <a href="https://facebook.com/InstaForexNigeria"><img src="https://instafxng.com/images/Facebook.png"></a>
                    <a href="https://twitter.com/instafxng"><img src="https://instafxng.com/images/Twitter.png"></a>
                    <a href="https://www.instagram.com/instafxng/"><img src="https://instafxng.com/images/instagram.png"></a>
                    <a href="https://www.youtube.com/channel/UC0Z9AISy_aMMa3OJjgX6SXw"><img src="https://instafxng.com/images/Youtube.png"></a>
                    <a href="https://linkedin.com/company/instaforex-ng"><img src="https://instafxng.com/images/LinkedIn.png"></a>
                </p>
                <p><strong>Head Office Address:</strong> TBS Place, Block 1A, Plot 8, Diamond Estate, Estate Bus-Stop, LASU/Isheri road, Isheri Olofin, Lagos.</p>
                <p><strong>Lekki Office Address:</strong> Block A3, Suite 508/509 Eastline Shopping Complex, Opposite Abraham Adesanya Roundabout, along Lekki - Epe expressway, Lagos.</p>
                <p><strong>Office Number:</strong> 08028281192</p>
                <br />
            </div>
            <div style="font-size: 10px !important; padding: 15px; text-align: center;">
                <p>This email was sent to you by Instant Web-Net Technologies Limited, the
                    official Nigerian Representative of Instaforex, operator and administrator
                    of the website www.instafxng.com</p>
                <p>To ensure you continue to receive special offers and updates from us,
                    please add support@instafxng.com to your address book.</p>
            </div>
        </div>
    </div>
</div>
MAIL;

    return $my_message_template;
}

function student_auto_mail_query($query_type, $day_value) {

    $today = date('Y-m-d');

    switch($query_type) {
        case 1:
            $query = "SELECT u.first_name, u.email
                FROM user_edu_exercise_log AS ueel
                INNER JOIN user AS u ON ueel.user_code = u.user_code
                INNER JOIN account_officers AS ao ON u.attendant = ao.account_officers_id
                INNER JOIN admin AS a ON ao.admin_code = a.admin_code
                LEFT JOIN user_edu_fee_payment AS uefp ON ueel.user_code = uefp.user_code
                WHERE (DATEDIFF('$today', STR_TO_DATE(uefp.created, '%Y-%m-%d')) = $day_value) AND uefp.user_code = u.user_code AND u.user_code <> ueel.usercode AND ueel.lesson_id = 1
                GROUP BY ueel.user_code ORDER BY u.academy_signup DESC, u.last_name ASC";
            break;
        case 2:
            $query = "SELECT u.first_name, u.email
                FROM user_edu_exercise_log AS ueel
                INNER JOIN user AS u ON ueel.user_code = u.user_code
                INNER JOIN account_officers AS ao ON u.attendant = ao.account_officers_id
                INNER JOIN admin AS a ON ao.admin_code = a.admin_code
                LEFT JOIN user_edu_fee_payment AS uefp ON ueel.user_code = uefp.user_code
                WHERE (DATEDIFF('$today', STR_TO_DATE(ueel.created, '%Y-%m-%d')) = $day_value) AND ueel.lesson_id <= 6 AND uefp.user_code = u.user_code
                GROUP BY ueel.user_code ORDER BY u.academy_signup DESC, u.last_name ASC";
            break;
        case 3:
            $query = "SELECT u.first_name, u.email
                FROM user_edu_exercise_log AS ueel AND user_deposit AS ud
                INNER JOIN user AS u ON ueel.user_code = u.user_code
                INNER JOIN account_officers AS ao ON u.attendant = ao.account_officers_id
                INNER JOIN admin AS a ON ao.admin_code = a.admin_code
                LEFT JOIN user_edu_fee_payment AS uefp ON ueel.user_code = uefp.user_code
                WHERE (DATEDIFF('$today', STR_TO_DATE(ueel.created, '%Y-%m-%d')) = $day_value) AND ueel.lesson_id = 13 AND uefp.user_code <> ud.user_code
                GROUP BY ueel.user_code ORDER BY u.academy_signup DESC, u.last_name ASC";
            break;
        default:
            $query = "";
    }

    return $query;
}

function student_auto_mail_send($query, $my_subject_raw, $my_message_raw) {
    global $db_handle;
    global $system_object;

    $result = $db_handle->runQuery($query);
    $fetched_data = $db_handle->fetchAssoc($result);

    foreach ($fetched_data as $row) {
        $client_name = ucwords(strtolower(trim($row['first_name'])));
        $client_email = strtolower(trim($row['email']));

        $my_subject = $my_subject_raw;
        $my_message = $my_message_raw;

        // Replace [NAME] with clients full name
        $my_message_new = str_replace('[NAME]', $client_name, $my_message);
        $my_subject_new = str_replace('[NAME]', $client_name, $my_subject);

        $system_object->send_email($my_subject_new, $my_message_new, $client_email, $client_name);
    }

    return true;
}

//TODO: Refactor and make it dynamic

// 10 day interval
$interval_1a = 7;

$query_1a = student_auto_mail_query(1, $interval_1a);
$get_mail_1a = student_auto_mail_template($my_message_1a);
$send_message_1a = student_auto_mail_send($query_1a, $my_subject_1a, $get_mail_1a);

$interval_1b = 14;

$query_1b = student_auto_mail_query(1, $interval_1b);
$get_mail_1b = student_auto_mail_template($my_message_1b);
$send_message_1b = student_auto_mail_send($query_1b, $my_subject_1b, $get_mail_1b);

$interval_1c = 21;

$query_1c = student_auto_mail_query(1, $interval_1c);
$get_mail_1c = student_auto_mail_template($my_message_1c);
$send_message_1c = student_auto_mail_send($query_1c, $my_subject_1c, $get_mail_1c);

$interval_1d = 28;

$query_1d = student_auto_mail_query(1, $interval_1d);
$get_mail_1d = student_auto_mail_template($my_message_1d);
$send_message_1d = student_auto_mail_send($query_1d, $my_subject_1d, $get_mail_1d);


$interval_2a = 14;

$query_2a = student_auto_mail_query(2, $interval_2a);
$get_mail_2a = student_auto_mail_template($my_message_2a);
$send_message_2a = student_auto_mail_send($query_2a, $my_subject_2a, $get_mail_2a);

$interval_2b = 28;

$query_2b = student_auto_mail_query(2, $interval_2b);
$get_mail_2b = student_auto_mail_template($my_message_2b);
$send_message_2b = student_auto_mail_send($query_2b, $my_subject_2b, $get_mail_2b);

$interval_2c = 32;

$query_2c = student_auto_mail_query(2, $interval_2c);
$get_mail_2c = student_auto_mail_template($my_message_2c);
$send_message_2c = student_auto_mail_send($query_2c, $my_subject_2c, $get_mail_2c);

$interval_2d = 46;

$query_2d = student_auto_mail_query(2, $interval_2d);
$get_mail_2d = student_auto_mail_template($my_message_2d);
$send_message_2d = student_auto_mail_send($query_2d, $my_subject_2d, $get_mail_2d);


$interval_3a = 15;

$query_3a = student_auto_mail_query(3, $interval_3a);
$get_mail_3a = student_auto_mail_template($my_message_3a);
$send_message_3a = student_auto_mail_send($query_3a, $my_subject_3a, $get_mail_3a);


$interval_3b = 30;

$query_3b = student_auto_mail_query(3, $interval_3b);
$get_mail_3b = student_auto_mail_template($my_message_3b);
$send_message_3b = student_auto_mail_send($query_3b, $my_subject_3b, $get_mail_3b);

$interval_3c = 45;

$query_3c = student_auto_mail_query(3, $interval_3c);
$get_mail_3c = student_auto_mail_template($my_message_3c);
$send_message_3c = student_auto_mail_send($query_3c, $my_subject_3c, $get_mail_3c);

$interval_3d = 60;

$query_3d = student_auto_mail_query(3, $interval_3d);
$get_mail_3d = student_auto_mail_template($my_message_3d);
$send_message_3d = student_auto_mail_send($query_3d, $my_subject_3d, $get_mail_3d);