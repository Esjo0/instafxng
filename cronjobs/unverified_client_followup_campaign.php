<?php
//set_include_path('/home/tboy9/public_html/init/');
set_include_path('../public_html/init/');
require_once 'initialize_general.php';
//Paid for the Forex optimizer Course but have not started
$my_subject_1 = "Anything for You [NAME]";
$my_message_1 =
    <<<MAIL
<p>Hello [NAME]</p>
<p>How are you today?</p>
<p>Been a while I heard from you</p>
<p>This is Mercy, from InstaForex Nigeria I thought to check up on you since I haven't seen you lately.</p>
<p>Hope you're doing really great.</p>
<p>As you know, there are endless opportunities to earn from the Forex market and I would want you to take the best of these opportunities as they come</p>
<p>I'm ready to work with you to make this journey a very profitable one so let's consider it our little project.</p>
<p>Have you ever encountered any challenge trading Forex? Are you skeptical about this Forex trading thing and you don't even know how to start?</p>
<p>Whatever it is, I'm right here waiting patiently to take your hands and walk you through this journey to the point of profitable trading.</p>
<p>To make this work, please share your experience and challenges with me by <a href="mailto:support@instafxng.com?subject=Challenges%20Faced%20Trading%20%20on%20InstaForex%20Platform%20&body=Hello%20Mercy,%0A%0AHere%20are%20the%20Challenges%20%20Faced.%0A%0A%20Please%20type%20your%20challenges%20below.%0A%0AThanks!">clicking here</a></p>
<p>As agreed earlier, I'm ready to attend to you and assist you on the journey to making consistent income from Forex trading so don't delay.</p>
<p>There are 40 slots available for this month and they are filled on a first come first served basis.</p>
<p>As soon as I get the 40th response, this session will be closed and you might have to wait till December to get another chance.</p>
<p>Do ensure to share it with me <a href="mailto:support@instafxng.com?subject=Challenges%20Faced%20Trading%20%20on%20InstaForex%20Platform%20&body=Hello%20Mercy,%0A%0AHere%20are%20the%20Challenges%20%20Faced.%0A%0A%20Please%20type%20your%20challenges%20below.%0A%0AThanks!">here</a>.</p>
<p>I'll be on the other side waiting to hear from you.</p>
MAIL;

$my_subject_2 = "You are the Next Target!";
$my_message_2 =
    <<<MAIL
<p>Dear [NAME],</p>
<p>How are you today?</p>
<p>A lot of amazing things have been happening and you sure have been MIA (missing in action)!</p>
<p>Over the last 2 months, we have produced about a thousand profitable InstaForex traders who are consistently making profits from their trades and are gainfully increasing their take home cash every day.</p>
<p>We would like to get you there too as our pride lies in your success as Forex traders so let's pick it up from where you stopped because you are long overdue for back to back profits.</p>
<p>We are ready to catapult you to the top.</p>
<p>To make this happen, we are going to increase whatever you deposit into your InstaForex account this month!</p>
<p>Grab a deposit bonus! Certainly, you are eligible for 30-130% bonus on your deposits only if you take action right now.</p>
<p>This offer is open for 3 weeks only and we're not sure we'll let out this offer again anytime soon.</p>
<p><a href="mailto:support@instafxng.com?subject=What%20Bonus%20can%20I%20Claim%20&body=Hi%20Mercy,%20kindly%20%20advice%20me%20on%20the%20best%20bonus%20available.%0A%0AThanks!">
Click here to find out the bonus applicable to you</a> and we'll guide you through immediately.</p>
<p> [NAME], you are the next profitable trader to emerge and I won't let you do this alone!</p>
<p><a href="http://bit.ly/2hnVw7d">Click here to make your deposit now and claim your deposit right away!</a></p>
MAIL;

$my_subject_3 = "Take This Opportunity Now";
$my_message_3 =
    <<<MAIL
<p>Dear [NAME],</p>
<p>I thought to share this experience with you.	</p>
<p>Around 2010, my friend was invited to buy bitcoin at a rate far lesser than 50 cent, but the understanding was not so clear, so he MISSED IT.</p>
<p>Another friend took the risk and made his decision, he invested just $100 and became wealthy when bitcoins became a hit. </p>
<p>I missed the opportunity and now bitcoins cost more to invest in. I learnt my lesson the hard way.</p>
<p>If Bitcoin had become a failed project, he would have lost $100 (N36,100) and nobody would have probably heard of this loss, but Bitcoin is a success, so he became a millionaire and everyone celebrates him.</p>
<p>When starting out a business, it's important that you plan, research and take action immediately.</p>
<p>What has been holding you back [NAME]?</p>
<p>You were ready to start earning in dollars when you signed up with us, don't be stuck there! Houses are not left in an architect's plan, so start building.</p>
<p>Are you totally new to Forex and you haven't had any education on how to trade Forex profitably, this is for you! Click <a href="http://bit.ly/2iExTpN">here</a> to start learning how to trade Forex for Free.</p>
<p>Are you way you are way past the learning stage, take action now. </p>
<p>All the tools you need to trade profitably have been provided, click here to top up your account and <a href="http://bit.ly/2KEWxWQ">here</a> to subscribe to a profit making strategy designed to book you up to 30-100 pips daily.</p>
<p>Don't be like me! There is nothing such as overnight success, you have to make the move now!</p>
<p>I'll love to guide you further, feel free to right me back.</p>
MAIL;

$my_subject_4 = "[NAME], The Next Step Leads to 30-50 pips daily";
$my_message_4 =
    <<<MAIL
<p>Dear [NAME],</p>
<p>If I told you, you could make a steady profit of $30 -$50 daily, would you believe that?</p>
<p>Well, it's true!</p>
<p>We recently launched our high precision trading signals that has 85% accuracy and is sure to deliver 30-50 green pips to your account on a daily basis.</p>
<p>Imagine waking every day with a lot of enthusiasm…looking forward to making the day's profit right on your bed… the possibility of making $30 every working day for a month…</p>
<p>Wow! This means that you'd be making up to N53 000 weekly and an average of N212 000 every month! Can you dig that?</p>
<p>Trust me, this is the reality for some traders right now and you can make it happen for you too.</p>
<p> Check out the result of our signals between Friday 29th June till today 4th July on very small lot sizes.</p>
<p><center><img class="img img-responsive" src="https://instafxng.com/imgsource/Trade%20Results.png"></center></p>
<p>Now it's the time to go ahead to get your trading account ready by depositing some funds and clicking here to sign up to receive notifications as soon as the signals are posted.</p>
<p>Have you claimed your 100% bonus yet? If you can afford to start with $50, $100 or $150, you are sure to get an extra 100% bonus on your first deposit.</p>
<p><a href="mailto:support@instafxng.com?subject=100%25%20Bonus%20&body=Hello%20Mercy,%0A%0AI%20am%20interested%20in%20getting%20the%20100%25%20bonus.%0A%0AThanks!">Click here to claim your 100% bonus now!</a></p>
<p><strong>Can't afford $50 yet?</strong> Not to worry! You can start with as low as $5 or $10 and start making profit on your trade.</p>
<p>I have your best interest at heart and I can't wait for you to join me.</p>
<p>Don't leave money on the table [NAME]! Click <a href="http://bit.ly/2zd3gmH">here</a> to proceed to fund your account here and let's get you started!</p>
<p>The signals are always posted daily on our website and all you need to do is bookmark the page and check daily.</p>
<p>NO TIME?</p>
<p>If you will be busy and won't have time to keep up with the site opt in for the daily alerts and I will be sure to update you on Facebook messenger as soon as the signals are posted, <a href="http://bit.ly/2KoYHe6">click here to subscribe to our signals channel now!</a></p>
<p>Should you need further assistance with this, feel free to send me a response to this mail. I'll be on hand waiting to receive your reply.</p>
MAIL;

$my_subject_5 = "Make up to $4200 and N1 Million Naira While you take your normal trades";
$my_message_5 =
    <<<MAIL
<p>Have you heard about our Loyalty Points Promo?</p>
<p>This mind-blowing unified reward program rewards every single one of our loyal clients daily, monthly and annually.</p>
<p>With this programme, everyone is a winner!</p>
<p>During the last round of the promotion, a total of 4.390 Million Naira was paid out to clients in rewards and this doesn't even include the thousands of dollars withdrawn as loyalty points!</p>
<p>Excited already? Here is how it works…</p>
<p>You don't need to do anything extra other than make deposit into your trading account and trade.</p>
<p>You earn point commensurate to your trading activities and these points help you to rank on a monthly and yearly rank scale where only you can get up to $4200 and N1 000 000 every month.</p>
<p>You're very eligible to earn this cash prizes and I would really encourage you to dive in right now!</p>
<p>Three Easy Steps to Get Started</p>
<p>1.Fund your trading account.</p>
<p>2.Trade with our 85% high-precision trading signals.</p>
<p>3.Earn Loyalty Points.</p>
<p>That's it [NAME], in three easy steps you would get a chance to get more rewards for making money!</p>
<p>Don't wait it out! Start earning on your trades now!</p>
<p><a href="http://bit.ly/2gvoIEU" title="Click to know more about our ILPR Promo">Here's where to go to get more information on the loyalty points program.</a></p>
MAIL;

function mail_template($core_msg) {

    $my_message_template =
        <<<MAIL
<div style="background-color: #F3F1F2">
    <div style="max-width: 80%; margin: 0 auto; padding: 10px; font-size: 14px; font-family: Verdana;">
        <img src="https://instafxng.com/images/ifxlogo.png" />
        <hr />
        <div style="background-color: #FFFFFF; padding: 15px; margin: 5px 0 5px 0;">

            $core_msg

            <br /><br />
            <p>Best Regards,</p>

            <p>Your friend,<br />
            Mercy,<br />
            Client Relations Manager.</p>
            <p>Instaforex Nigeria,<br />
                www.instafxng.com</p>
            <br /><br />
        </div>
        <hr />
        <div style="background-color: #EBDEE9;">
            <div style="font-size: 11px !important; padding: 15px;">
                <p style="text-align: center"><span style="font-size: 12px"><strong>We're Social</strong></span><br /><br />
                    <a href="https://facebook.com/InstaForexNigeria"><img src="https://instafxng.com/images/Facebook.png"></a>
                    <a href="https://twitter.com/instafxng"><img src="https://instafxng.com/images/Twitter.png"></a>
                    <a href="https://www.instagram.com/instafxng/"><img src="https://instafxng.com/images/instagram.png"></a>
                    <a href="https://www.youtube.com/channel/UC0Z9AISy_aMMa3OJjgX6SXw"><img src="https://instafxng.com/images/Youtube.png"></a>
                    <a href="https://linkedin.com/company/instaforex-ng"><img src="https://instafxng.com/images/LinkedIn.png"></a>
                </p>
                <p><strong>Head Office Address:</strong> TBS Place, Block 1A, Plot 8, Diamond Estate, Estate Bus-Stop, LASU/Isheri road, Isheri Olofin, Lagos.</p>
                <p><strong>Lekki Office Address:</strong> Block A3, Suite 508/509 Eastline Shopping Complex, Opposite Abraham Adesanya Roundabout, along Lekki - Epe expressway, Lagos.</p>
                <p><strong>Office Number:</strong> 08028281192</p>
                <br />
            </div>
            <div style="font-size: 10px !important; padding: 15px; text-align: center;">
                <p>This email was sent to you by Instant Web-Net Technologies Limited, the
                    official Nigerian Representative of Instaforex, operator and administrator
                    of the website www.instafxng.com</p>
                <p>To ensure you continue to receive special offers and updates from us,
                    please add support@instafxng.com to your address book.</p>
            </div>
        </div>
    </div>
</div>
MAIL;

    return $my_message_template;
}

function mail_query($query_type, $day_value, $email_flag) {

    $today = date('Y-m-d');
    switch($query_type) {

        // All unverified clients that are not part of training
        case 1:
            $query = "SELECT u.user_code, u.first_name, u.email
            FROM user AS u
            INNER JOIN account_officers AS ao ON u.attendant = ao.account_officers_id
            INNER JOIN admin AS a ON ao.admin_code = a.admin_code
            WHERE (u.password IS NULL OR u.password = '') AND u.email NOT IN (SELECT email FROM unverified_campaign_mail_log)
            AND u.user_code NOT IN (SELECT user_code FROM user AS U WHERE U.academy_signup IS NOT NULL)
            AND (DATEDIFF('$today', STR_TO_DATE(u.created, '%Y-%m-%d')) = '$day_value')
            GROUP BY u.email ORDER BY u.created DESC, u.last_name ASC LIMIT 200";
            break;

        // All unverified clients, with consideration of when the last email was received
        case 2:
            $query = "SELECT u.user_code, u.first_name, u.email
            FROM user AS u
            INNER JOIN account_officers AS ao ON u.attendant = ao.account_officers_id
            INNER JOIN admin AS a ON ao.admin_code = a.admin_code
            WHERE (u.password IS NULL OR u.password = '') AND u.email
            IN (SELECT email FROM unverified_campaign_mail_log AS ucml
            WHERE (DATEDIFF('$today', STR_TO_DATE(ucml.created, '%Y-%m-%d')) = '$day_value'))
            AND u.user_code NOT IN (SELECT user_code FROM user AS U WHERE U.academy_signup IS NOT NULL)
            AND u.email NOT IN(SELECT email FROM unverified_campaign_mail_log AS ucml WHERE ucml.email_flag = '$email_flag')
            GROUP BY u.email ORDER BY u.created DESC, u.last_name ASC LIMIT 200";
            break;
        default:
            $query = "";
    }
    return $query;
}

function auto_mail_send($query, $my_subject_raw, $my_message_raw, $flag) {
    global $db_handle;
    global $system_object;

    $result = $db_handle->runQuery($query);
    $fetched_data = $db_handle->fetchAssoc($result);

    foreach ($fetched_data as $row) {
        $client_name = ucwords(strtolower(trim($row['first_name'])));
        $client_email = strtolower(trim($row['email']));

        $my_subject = $my_subject_raw;
        $my_message = $my_message_raw;

        // Replace [NAME] with clients full name
        $my_message_new = str_replace('[NAME]', $client_name, $my_message);
        $my_subject_new = str_replace('[NAME]', $client_name, $my_subject);

        $system_object->send_email($my_subject_new, $my_message_new, $client_email, $client_name);
        $system_object->unverified_email_campaign_log($client_email, $flag);

    }

    return true;
}

//TODO: Refactor and make it dynamic
//14 days after  newe client remains unverified
$interval_1 = 14;

$query_1 = mail_query(1, $interval_1, 1);
$get_mail_1 = mail_template($my_message_1);
$send_message_1 = auto_mail_send($query_1, $my_subject_1, $get_mail_1, 1);

// After recieving the first mail.
$interval_2 = 7;

$query_2 = mail_query(2, $interval_2, 2);
$get_mail_2 = mail_template($my_message_2);
$send_message_2 = auto_mail_send($query_2, $my_subject_2, $get_mail_2, 2);

$interval_3 = 14;

$query_3 = mail_query(2, $interval_3, 3);
$get_mail_3 = mail_template($my_message_3);
$send_message_3 = auto_mail_send($query_3, $my_subject_3, $get_mail_3, 3);

$interval_4 = 21;

$query_4 = mail_query(2, $interval_4, 4);
$get_mail_4 = mail_template($my_message_4);
$send_message_4 = auto_mail_send($query_4, $my_subject_4, $get_mail_4, 4);

$interval_5 = 28;

$query_5 = mail_query(2, $interval_5, 5);
$get_mail_5 = mail_template($my_message_5);
$send_message_5 = auto_mail_send($query_5, $my_subject_5, $get_mail_5, 5);